- uses: actions/checkout@v1

- name: 'ci'
  run: npm ci

- name: 'build'
  run: npm run build

- name: 'test'
  run: npm run test
  env:
    GSHEET_CLIENT_EMAIL: ${{ secrets.GSHEET_CLIENT_EMAIL }}
    GSHEET_PRIVATE_KEY: ${{ secrets.GSHEET_PRIVATE_KEY }}
    TEST_SPREADSHEET_ID: ${{ secrets.TEST_SPREADSHEET_ID }}

- name: 'check for uncommitted changes'
  # Ensure no changes, but ignore node_modules dir since dev/fresh ci deps installed.
  run: |
    git diff --exit-code --stat -- . ':!node_modules' \
    || (echo "##[error] found changed files after build. please 'npm run build && npm run format'" \
              "and check in all changes" \
        && exit 1)
